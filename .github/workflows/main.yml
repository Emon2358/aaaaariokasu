name: Decompile EXE and Upload

on:
  workflow_dispatch:

jobs:
  decompile:
    runs-on: ubuntu-latest
    env:
      DECOMPILATION_ALLOWED: true

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y wget unzip python3 python3-pip
          pip install uncompyle6

      - name: Download EXE
        run: |
          wget -O PmmaSoftware.exe "https://github.com/Emon2358/aaaaariokasu/releases/download/aaaaropkasui/PmmaSoftware.exe"

      - name: Decompile EXE
        if: env.DECOMPILATION_ALLOWED == 'true'
        run: |
          mkdir -p decompiled
          unzip -o PmmaSoftware.exe -d decompiled || echo "Couldn't unzip, trying strings"
          strings PmmaSoftware.exe > decompiled/raw_strings.txt

      - name: Upload Decompiled Files
        uses: actions/upload-artifact@v4
        with:
          name: decompiled-files
          path: decompiled/
